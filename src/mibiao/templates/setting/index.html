{% extends 'base.html' %}


{% block content %}
  <div>

    <div>
      <a href="{{ url_for('domain.list') }}">管理域名</a>
    </div>

    <div id="app">
      <span>@{counter.value}</span>
      <el-button type="primary" @click="handleClick">你好</el-button>
    </div>
  </div>
{% endblock %}



{% block styles %}
  {{ super() }}
  <!--element-plus-->
  <link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/element-plus/2.8.8/index.min.css"
        integrity="sha512-r5oxEDAlj7jwk5RhxKxszBFjYQPOitY2sq8s+W4qxcgB8CZYafomy+TBHEC1L4jSQQAGkUzJlMgA2jv0T1sNgA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/element-plus/2.8.8/theme-chalk/index.min.css"
        integrity="sha512-r5oxEDAlj7jwk5RhxKxszBFjYQPOitY2sq8s+W4qxcgB8CZYafomy+TBHEC1L4jSQQAGkUzJlMgA2jv0T1sNgA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/element-plus/2.8.8/theme-chalk/el-icon.min.css"
        integrity="sha512-EPjt77BiTdoqWPIYJRZpB5NX+mv6TMQYMyNs/dQSLvlzL0VHYSnJv00tNysRSDo70Auaw4jmgEM84TdahCVwsw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"
  />
{% endblock %}

{% block scripts %}
  {{ super() }}
  <!--vue-->
  <script src="https://s4.zstatic.net/ajax/libs/vue/3.5.13/vue.global.prod.min.js"
          integrity="sha512-66fV4MXSQdGN0KQxZ0Bw627HalhTQYQbOoF24EtMXN2FaAoKMgAZ7nDi77d9xWwrRjEEUfE+7rxjTt+cA2IuJA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"
  >
  </script>

  <!--vue-router-->
  <script src="https://s4.zstatic.net/ajax/libs/vue-router/4.4.5/vue-router.global.prod.min.js"
          integrity="sha512-p/NZFNVGoSeQ/D8zHTcdjgoZHrpvqi2GOepWI8HQyuJqry/HVcLvdPesvaQlu0k1foYdjdmFB9H+C0MwJYEkfg=="
          crossorigin="anonymous" referrerpolicy="no-referrer"
  >
  </script>

  <!--vue-demi-->
  <script src="https://s4.zstatic.net/ajax/libs/vue-demi/0.14.10/index.iife.min.js"
          integrity="sha512-WlWfdPbyuYoflob4Dj7iU5tJ+ZAVNKYJwmxeFObn70TrhtcBgf9hl59hwV1+22uaZKF3u2+M8J+60lMtekJFvA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"
  >
  </script>

  <!--pinia-->
  <script src="https://s4.zstatic.net/ajax/libs/pinia/2.2.6/pinia.iife.prod.min.js"
          integrity="sha512-2zl+gQrXtb+//CCFRVbzNWr5U2bIXrR231yrsuR99pFCxCY9pEuu1sQVyWsYmpaS32789EesiAyFNZX5Sr0Qeg=="
          crossorigin="anonymous" referrerpolicy="no-referrer"
  >
  </script>


  <!--element-plus-->
  <script src="https://s4.zstatic.net/ajax/libs/element-plus/2.8.8/index.full.min.js"
          integrity="sha512-u7rN9ugWES+cwhSXacu0roDM+Dn7jWv4DzQ42NXoBcn58e/VTMUIQ5NKIrEiSPbDF2hdbt4E9+0/ANPVaH+tMA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"
  >
  </script>

  <!--element-plus-icons-vue-->
  <script src="https://s4.zstatic.net/ajax/libs/element-plus-icons-vue/2.3.1/index.iife.min.js"
          integrity="sha512-F2sV0V7qeAmq6FfnxL1WrmueAprl0Um6wJgZ2S4iDfcCxhKXI89cxegixmrX4LB+epMApTxZ1jItY4RX7Tje/w=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"
  >
  </script>

  <!--lodash-->
  <script src="https://s4.zstatic.net/ajax/libs/lodash.js/4.17.21/lodash.min.js"
          integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ=="
          crossorigin="anonymous" referrerpolicy="no-referrer"
  >
  </script>

  <!--dayjs-->
  <script src="https://s4.zstatic.net/ajax/libs/dayjs/1.11.13/dayjs.min.js"
          integrity="sha512-FwNWaxyfy2XlEINoSnZh1JQ5TRRtGow0D6XcmAWmYCRgvqOUTnzCxPc9uF35u5ZEpirk1uhlPVA19tflhvnW1g=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"
  >
  </script>

  <script>
    const {ElMessage} = ElementPlus

    async function checkResponseDataOkOrError(status, data) {
      if (data && data.err && status !== 401) {
        ElMessage.error(data.err.msg);
        return false;
      }
      return true;
    }

    async function checkResponseStatusOkOrError(status) {
      switch (status) {
        case 400:
          ElMessage.error('参数错误');
          return false;
        case 401:
          ElMessage.error('请重新登陆');
          return false;
        case 403:
          ElMessage.error('服务器拒绝访问');
          return false;
        case 404:
          ElMessage.error('请求地址错误');
          return false;
        case 500:
          ElMessage.error('服务器故障');
          return false;
        default:
          ElMessage.error('网络连接故障');
          return false;
      }
    }

    function getToken() {
      return 'hello world';
    }

    async function sendHttpRequest(method, url, data, options) {
      const headers = {
        Authorization: `Bearer ${getToken()}`,
      };

      const defaultOptions = {
        method,
        headers,
        async onRequest({request, options}) {
        },
        async onRequestError({request, options, error}) {
          ElMessage.error('Http请求出错，请重试！');
        },
        async onResponse({request, response, options}) {
        },
        async onResponseError({request, options, response}) {
          if (!(await checkResponseDataOkOrError(response.status, response.data))) {
            return;
          }
          await checkResponseStatusOkOrError(response.status);
        },
      };
      if (method === 'GET') {
        defaultOptions.query = data || {};
      } else {
        defaultOptions.body = data || {};
      }
      const finalOptions = _.merge(defaultOptions, options || {});
      return await fetch(url, finalOptions);
    }

    async function sendHttpGet(url, data, options) {
      return await sendHttpRequest('GET', url, data, options);
    }

    async function sendHttpPost(url, data, options) {
      return await sendHttpRequest('POST', url, data, options);
    }

    async function sendHttpPut(url, data, options) {
      return await sendHttpRequest('PUT', url, data, options);
    }

    async function sendHttpForm(url, formData, options) {
      return await sendHttpRequest('POST', url, formData, options);
    }
  </script>

  <script>
    const {defineStore} = Pinia;
    const useCounterStore = defineStore('counter', {
      state() {
        return {
          value: 0
        }
      },
      actions: {
        increment(state) {
          console.log(state);
          this.value++;
          ElMessage.error('hello');
        }
      }
    })
  </script>

  <script>
    const {ref, computed} = Vue;
    const App = {
      delimiters: ["@{", "}"],
      components: {},
      setup() {
        const counter = useCounterStore();

        function handleClick() {
          counter.increment();
          console.log(counter.value);
        }

        return {counter, handleClick}
      },
    }
  </script>

  <script>
    const {createPinia} = Pinia;
    const {createApp} = Vue;
    const {createRouter, createWebHashHistory} = VueRouter;

    const app = createApp(App);
    const router = createRouter({
      history: createWebHashHistory(),
      routes: [],
    });
    const pinia = createPinia();

    app.use(pinia);
    app.use(ElementPlus);
    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
      app.component(key, component);
    }
    app.mount('#app');

  </script>
{% endblock scripts %}
